(()=>{"use strict";function e(e,t){return Object.fromEntries(Object.entries(e).filter((([e,n])=>t(n,e))))}function t(e){if(!(e instanceof Error))return e;const t={};return Object.getOwnPropertyNames(e).forEach((n=>{t[n]=e[n]})),t}const n={log:"log",debug:"debug",info:"info",warn:"warn",error:"error"},o=console,r={};Object.keys(n).forEach((e=>{r[e]=o[e]}));const s="Datadog Browser SDK:",i={debug:r.debug.bind(o,s),log:r.log.bind(o,s),info:r.info.bind(o,s),warn:r.warn.bind(o,s),error:r.error.bind(o,s)},a="https://docs.datadoghq.com",c=`${a}/real_user_monitoring/browser/troubleshooting`,u="More details:";function l(e,t){return(...n)=>{try{return e(...n)}catch(e){i.error(t,e)}}}let d,f=!1;function p(e){f=e}function g(e){return function(){return m(e,this,arguments)}}function m(e,t,n){try{return e.apply(t,n)}catch(e){!function(e){if(h(e),d)try{d(e)}catch(e){h(e)}}(e)}}function h(...e){f&&i.error("[MONITOR]",...e)}function y(){if("object"==typeof globalThis)return globalThis;Object.defineProperty(Object.prototype,"_dd_temp_",{get(){return this},configurable:!0});let e=_dd_temp_;return delete Object.prototype._dd_temp_,"object"!=typeof e&&(e="object"==typeof self?self:"object"==typeof window?window:{}),e}const b=/[^\u0000-\u007F]/;function v(e){return b.test(e)?void 0!==window.TextEncoder?(new TextEncoder).encode(e).length:new Blob([e]).size:e.length}function w(e,t){const n=y();let o;return n.Zone&&"function"==typeof n.Zone.__symbol__&&(o=e[n.Zone.__symbol__(t)]),o||(o=e[t]),o}function S(e,t){return w(y(),"setTimeout")(g(e),t)}function _(e){w(y(),"clearTimeout")(e)}function E(e,t){return w(y(),"setInterval")(g(e),t)}function k(e){w(y(),"clearInterval")(e)}function C(e,t,n){const o=!n||void 0===n.leading||n.leading,r=!n||void 0===n.trailing||n.trailing;let s,i,a=!1;return{throttled:(...n)=>{a?s=n:(o?e(...n):s=n,a=!0,i=S((()=>{r&&s&&e(...s),a=!1,s=void 0}),t))},cancel:()=>{_(i),a=!1,s=void 0}}}function x(){}function T(e,t,n){if("object"!=typeof e||null===e)return JSON.stringify(e);const o=L(Object.prototype),r=L(Array.prototype),s=L(Object.getPrototypeOf(e)),i=L(e);try{return JSON.stringify(e,t,n)}catch(e){return"<error: unable to serialize object>"}finally{o(),r(),s(),i()}}function L(e){const t=e,n=t.toJSON;return n?(delete t.toJSON,()=>{t.toJSON=n}):x}function $(e,t){return Object.keys(e).some((n=>e[n]===t))}function I(e){return 0===Object.keys(e).length}function A(e){let t=0;const{throttled:n,cancel:o}=C((n=>{t=v(T(n)),e()}),200),r=()=>{o(),t=0};return{updateCustomerData:e=>{I(e)?r():n(e)},resetCustomerData:r,getBytesCount:()=>t,stop:()=>{o()}}}function O(e){return null===e?"null":Array.isArray(e)?"array":typeof e}function R(e,t,n=function(){if("undefined"!=typeof WeakSet){const e=new WeakSet;return{hasAlreadyBeenSeen(t){const n=e.has(t);return n||e.add(t),n}}}const e=[];return{hasAlreadyBeenSeen(t){const n=e.indexOf(t)>=0;return n||e.push(t),n}}}()){if(void 0===t)return e;if("object"!=typeof t||null===t)return t;if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp){const e=t.flags||[t.global?"g":"",t.ignoreCase?"i":"",t.multiline?"m":"",t.sticky?"y":"",t.unicode?"u":""].join("");return new RegExp(t.source,e)}if(n.hasAlreadyBeenSeen(t))return;if(Array.isArray(t)){const o=Array.isArray(e)?e:[];for(let e=0;e<t.length;++e)o[e]=R(o[e],t[e],n);return o}const o="object"===O(e)?e:{};for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&(o[e]=R(o[e],t[e],n));return o}function P(e){return R(void 0,e)}function N(...e){let t;for(const n of e)null!=n&&(t=R(t,n));return t}function q(e,t=225280){const n=L(Object.prototype),o=L(Array.prototype),r=[],s=new WeakMap,i=M(e,"$",void 0,r,s),a=JSON.stringify(i);let c=a?a.length:0;if(!(c>t)){for(;r.length>0&&c<t;){const n=r.shift();let o=0;if(Array.isArray(n.source))for(let i=0;i<n.source.length;i++){const a=M(n.source[i],n.path,i,r,s);if(c+=void 0!==a?JSON.stringify(a).length:4,c+=o,o=1,c>t){B(t,"truncated",e);break}n.target[i]=a}else for(const i in n.source)if(Object.prototype.hasOwnProperty.call(n.source,i)){const a=M(n.source[i],n.path,i,r,s);if(void 0!==a&&(c+=JSON.stringify(a).length+o+i.length+3,o=1),c>t){B(t,"truncated",e);break}n.target[i]=a}}return n(),o(),i}B(t,"discarded",e)}function M(e,t,n,o,r){const s=function(e){const t=e;if(t&&"function"==typeof t.toJSON)try{return t.toJSON()}catch(e){}return e}(e);if(!s||"object"!=typeof s)return"bigint"==typeof(i=s)?`[BigInt] ${i.toString()}`:"function"==typeof i?`[Function] ${i.name||"unknown"}`:"symbol"==typeof i?`[Symbol] ${i.description||i.toString()}`:i;var i;const a=U(s);if("[Object]"!==a&&"[Array]"!==a&&"[Error]"!==a)return a;const c=e;if(r.has(c))return`[Reference seen at ${r.get(c)}]`;const u=void 0!==n?`${t}.${n}`:t,l=Array.isArray(s)?[]:{};return r.set(c,u),o.push({source:s,target:l,path:u}),l}function U(e){try{if(e instanceof Event)return{type:(t=e).type,isTrusted:t.isTrusted,currentTarget:t.currentTarget?U(t.currentTarget):null,target:t.target?U(t.target):null};if(e instanceof RegExp)return`[RegExp] ${e.toString()}`;const n=Object.prototype.toString.call(e).match(/\[object (.*)\]/);if(n&&n[1])return`[${n[1]}]`}catch(e){}var t;return"[Unserializable]"}function B(e,t,n){i.warn(`The data provided has been ${t} as it is over the limit of ${e} characters:`,n)}class D{constructor(e){this.onFirstSubscribe=e,this.observers=[]}subscribe(e){return this.observers.push(e),1===this.observers.length&&this.onFirstSubscribe&&(this.onLastUnsubscribe=this.onFirstSubscribe(this)||void 0),{unsubscribe:()=>{this.observers=this.observers.filter((t=>e!==t)),!this.observers.length&&this.onLastUnsubscribe&&this.onLastUnsubscribe()}}}notify(e){this.observers.forEach((t=>t(e)))}}function j(...e){return new D((t=>{const n=e.map((e=>e.subscribe((e=>t.notify(e)))));return()=>n.forEach((e=>e.unsubscribe()))}))}function F(e){let t={};const n=new D,o={getContext:()=>P(t),setContext:r=>{"object"===O(r)?(t=q(r),null==e||e.updateCustomerData(t)):o.clearContext(),n.notify()},setContextProperty:(o,r)=>{t[o]=q(r),null==e||e.updateCustomerData(t),n.notify()},removeContextProperty:o=>{delete t[o],null==e||e.updateCustomerData(t),n.notify()},clearContext:()=>{t={},null==e||e.resetCustomerData(),n.notify()},changeObservable:n};return o}const z={GRANTED:"granted",NOT_GRANTED:"not-granted"};function H(e,t,n,o,r){return G(e,t,[n],o,r)}function G(e,t,n,o,{once:r,capture:s,passive:i}={}){const a=g((t=>{(t.isTrusted||t.__ddIsTrusted||e.allowUntrustedEvents)&&(r&&d(),o(t))})),c=i?{capture:s,passive:i}:s,u=window.EventTarget&&t instanceof EventTarget?window.EventTarget.prototype:t,l=w(u,"addEventListener");function d(){const e=w(u,"removeEventListener");n.forEach((n=>e.call(t,n,a,c)))}return n.forEach((e=>l.call(t,e,a,c))),{stop:d}}const W=[];function J(e,t,n,o){const r=function(e,t){return`_dd_c_${e}_${t}`}(n,o);function s(){const e=localStorage.getItem(r);return null!==e?JSON.parse(e):{}}W.push(H(e,window,"storage",(({key:e})=>{r===e&&t.setContext(s())}))),t.changeObservable.subscribe((function(){localStorage.setItem(r,JSON.stringify(t.getContext()))})),t.setContext(N(s(),t.getContext()))}const V="?";function K(e){const t=[];let n=re(e,"stack");const o=String(e);return n&&n.startsWith(o)&&(n=n.slice(o.length)),n&&n.split("\n").forEach((e=>{const n=function(e){const t=X.exec(e);if(!t)return;const n=t[2]&&0===t[2].indexOf("native"),o=t[2]&&0===t[2].indexOf("eval"),r=Z.exec(t[2]);return o&&r&&(t[2]=r[1],t[3]=r[2],t[4]=r[3]),{args:n?[t[2]]:[],column:t[4]?+t[4]:void 0,func:t[1]||V,line:t[3]?+t[3]:void 0,url:n?void 0:t[2]}}(e)||function(e){const t=ee.exec(e);if(t)return{args:[],column:t[3]?+t[3]:void 0,func:V,line:t[2]?+t[2]:void 0,url:t[1]}}(e)||function(e){const t=te.exec(e);if(t)return{args:[],column:t[4]?+t[4]:void 0,func:t[1]||V,line:+t[3],url:t[2]}}(e)||function(e){const t=ne.exec(e);if(!t)return;const n=t[3]&&t[3].indexOf(" > eval")>-1,o=oe.exec(t[3]);return n&&o&&(t[3]=o[1],t[4]=o[2],t[5]=void 0),{args:t[2]?t[2].split(","):[],column:t[5]?+t[5]:void 0,func:t[1]||V,line:t[4]?+t[4]:void 0,url:t[3]}}(e);n&&(!n.func&&n.line&&(n.func=V),t.push(n))})),{message:re(e,"message"),name:re(e,"name"),stack:t}}const Q="((?:file|https?|blob|chrome-extension|electron|native|eval|webpack|snippet|<anonymous>|\\w+\\.|\\/).*?)",Y="(?::(\\d+))",X=new RegExp(`^\\s*at (.*?) ?\\(${Q}${Y}?${Y}?\\)?\\s*$`,"i"),Z=new RegExp(`\\((\\S*)${Y}${Y}\\)`),ee=new RegExp(`^\\s*at ?${Q}${Y}?${Y}??\\s*$`,"i"),te=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,ne=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)((?:file|https?|blob|chrome|webpack|resource|capacitor|\[native).*?|[^@]*bundle)(?::(\d+))?(?::(\d+))?\s*$/i,oe=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i;function re(e,t){if("object"!=typeof e||!e||!(t in e))return;const n=e[t];return"string"==typeof n?n:void 0}const se=/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?([\s\S]*)$/;function ie(){const e=new Error;let t;return m((()=>{const n=K(e);n.stack=n.stack.slice(2),t=ae(n)})),t}function ae(e){let t=ce(e);return e.stack.forEach((e=>{const n="?"===e.func?"<anonymous>":e.func,o=e.args&&e.args.length>0?`(${e.args.join(", ")})`:"",r=e.line?`:${e.line}`:"",s=e.line&&e.column?`:${e.column}`:"";t+=`\n  at ${n}${o} @ ${e.url}${r}${s}`})),t}function ce(e){return`${e.name||"Error"}: ${e.message}`}const ue="No stack, consider using an instance of Error";function le({stackTrace:e,originalError:t,handlingStack:n,startClocks:o,nonErrorPrefix:r,source:s,handling:i}){const a=fe(t),c=function(e,t,n,o){return(null==e?void 0:e.message)&&(null==e?void 0:e.name)?e.message:t?"Empty message":`${n} ${T(q(o))}`}(e,a,r,t),u=function(e,t){return void 0!==t&&(!!e||t.stack.length>0&&(t.stack.length>1||void 0!==t.stack[0].url))}(a,e)?ae(e):ue,l=a?pe(t,s):void 0;return{startClocks:o,source:s,handling:i,handlingStack:n,originalError:t,type:e?e.name:void 0,message:c,stack:u,causes:l,fingerprint:de(t)}}function de(e){return fe(e)&&"dd_fingerprint"in e?String(e.dd_fingerprint):void 0}function fe(e){return e instanceof Error||"[object Error]"===Object.prototype.toString.call(e)}function pe(e,t){let n=e;const o=[];for(;fe(null==n?void 0:n.cause)&&o.length<10;){const e=K(n.cause);o.push({message:n.cause.message,source:t,type:null==e?void 0:e.name,stack:e&&ae(e)}),n=n.cause}return o.length?o:void 0}var ge;!function(e){e.WRITABLE_RESOURCE_GRAPHQL="writable_resource_graphql",e.REMOTE_CONFIGURATION="remote_configuration",e.ACTION_NAME_MASKING="action_name_masking",e.CONSISTENT_TRACE_SAMPLING="consistent_trace_sampling",e.DELAY_VIEWPORT_COLLECTION="delay_viewport_collection"}(ge||(ge={}));const me=new Set;const he="datadoghq.com",ye=["ddsource","ddtags"],be=1e3,ve=6e4;function we(){return(new Date).getTime()}function Se(){return we()}function _e(){return performance.now()}function Ee(){return{relative:_e(),timeStamp:Se()}}let ke;function Ce(){return void 0===ke&&(ke=performance.timing.navigationStart),ke}function xe(e,t){const n=window.__ddBrowserSdkExtensionCallback;n&&n({type:e,payload:t})}function Te(e){return 0!==e&&100*Math.random()<=e}function Le(){var e;const t=window.navigator;return{status:t.onLine?"connected":"not_connected",interfaces:t.connection&&t.connection.type?[t.connection.type]:void 0,effective_type:null===(e=t.connection)||void 0===e?void 0:e.effectiveType}}function $e(e,t){const n=e.indexOf(t);n>=0&&e.splice(n,1)}function Ie(){const e=[];return{add:t=>{e.push(t)>500&&e.splice(0,1)},remove:t=>{$e(e,t)},drain:t=>{e.forEach((e=>e(t))),e.length=0}}}const Ae="log",Oe="configuration",Re="usage",Pe=["https://www.datadoghq-browser-agent.com","https://www.datad0g-browser-agent.com","https://d3uc069fcn7uxw.cloudfront.net","https://d20xtzwzcl0ceb.cloudfront.net","http://localhost","<anonymous>"],Ne=["ddog-gov.com"];let qe=Ie(),Me=e=>{qe.add((()=>Me(e)))};function Ue(e,t){h(n.debug,e,t),Me({type:Ae,message:e,status:"debug",...t})}function Be(e,t){Me({type:Ae,status:"error",...De(e),...t})}function De(e){if(fe(e)){const t=K(e);return{error:{kind:t.name,stack:ae(je(t))},message:t.message}}return{error:{stack:ue},message:`Uncaught ${T(e)}`}}function je(e){return e.stack=e.stack.filter((e=>!e.url||Pe.some((t=>e.url.startsWith(t))))),e}function Fe(e){const t={...e};return["id","name","email"].forEach((e=>{e in t&&(t[e]=String(t[e]))})),t}function ze(e,t){t.silentMultipleInit||i.error(`${e} is already initialized.`)}const He="agent",Ge="console",We="logger",Je="source",Ve="report";function Ke(e,t,n){const o=n.getHandler(),r=Array.isArray(o)?o:[o];return Ye[e]>=Ye[n.getLevel()]&&r.includes(t)}const Qe={ok:"ok",debug:"debug",info:"info",notice:"notice",warn:"warn",error:"error",critical:"critical",alert:"alert",emerg:"emerg"},Ye={[Qe.ok]:0,[Qe.debug]:1,[Qe.info]:2,[Qe.notice]:4,[Qe.warn]:5,[Qe.error]:6,[Qe.critical]:7,[Qe.alert]:8,[Qe.emerg]:9};function Xe(e,{includeMessage:t=!1}={}){return{stack:e.stack,kind:e.type,message:t?e.message:void 0,causes:e.causes,fingerprint:e.fingerprint,handling:e.handling}}const Ze="http",et=Object.keys(Qe);class tt{constructor(e,t,n,o=Ze,r=Qe.debug,s={}){this.handleLogStrategy=e,this.handlerType=o,this.level=r,this.contextManager=F(t),this.contextManager.setContext(s),n&&this.contextManager.setContextProperty("logger",{name:n})}logImplementation(e,t,n=Qe.info,o,r){const s=q(t);let i;i=null!=o?N({error:Xe(le({stackTrace:fe(o)?K(o):void 0,originalError:o,nonErrorPrefix:"Provided",source:We,handling:"handled",startClocks:Ee()}),{includeMessage:!0})},s):s,this.handleLogStrategy({message:q(e),context:i,status:n},this,r)}log(e,t,n=Qe.info,o){let r;Ke(n,Ze,this)&&(r=ie()),this.logImplementation(e,t,n,o,r)}setContext(e){this.contextManager.setContext(e)}getContext(){return this.contextManager.getContext()}setContextProperty(e,t){this.contextManager.setContextProperty(e,t)}removeContextProperty(e){this.contextManager.removeContextProperty(e)}clearContext(){this.contextManager.clearContext()}setHandler(e){this.handlerType=e}getHandler(){return this.handlerType}setLevel(e){this.level=e}getLevel(){return this.level}}function nt(e){return function(t,n,o){let r;Ke(e,Ze,this)&&(r=ie()),this.logImplementation(t,n,e,o,r)}}function ot(){const e=y().DatadogEventBridge;if(e)return{getCapabilities(){var t;return JSON.parse((null===(t=e.getCapabilities)||void 0===t?void 0:t.call(e))||"[]")},getPrivacyLevel(){var t;return null===(t=e.getPrivacyLevel)||void 0===t?void 0:t.call(e)},getAllowedWebViewHosts:()=>JSON.parse(e.getAllowedWebViewHosts()),send(t,n,o){const r=o?{id:o}:void 0;e.send(JSON.stringify({eventType:t,event:n,view:r}))}}}function rt(e){var t;void 0===e&&(e=null===(t=y().location)||void 0===t?void 0:t.hostname);const n=ot();return!!n&&n.getAllowedWebViewHosts().some((t=>e===t||e.endsWith(`.${t}`)))}function st(e,t,n,{computeHandlingStack:o}={}){let r=e[t];if("function"!=typeof r){if(!(t in e)||!t.startsWith("on"))return{stop:x};r=x}let s=!1;const i=function(){if(s)return r.apply(this,arguments);const e=Array.from(arguments);let t;m(n,null,[{target:this,parameters:e,onPostCall:e=>{t=e},handlingStack:o?ie():void 0}]);const i=r.apply(this,e);return t&&m(t,null,[i]),i};return e[t]=i,{stop:()=>{s=!0,e[t]===i&&(e[t]=r)}}}function it(e){return function(e,t){const n=function(){if(void 0===ct)try{const e=new at("http://test/path");ct="http://test/path"===e.href}catch(e){ct=!1}return ct?at:void 0}();if(n)try{return void 0!==t?new n(e,t):new n(e)}catch(n){throw new Error(`Failed to construct URL: ${String(n)} ${T({url:e,base:t})}`)}if(void 0===t&&!/:/.test(e))throw new Error(`Invalid URL: '${e}'`);let o=document;const r=o.createElement("a");if(void 0!==t){o=document.implementation.createHTMLDocument("");const e=o.createElement("base");e.href=t,o.head.appendChild(e),o.body.appendChild(r)}return r.href=e,r}(e,location.href).href}(function(e,t,n,o){var r,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(i=(s<3?r(i):s>3?r(t,n,i):r(t,n))||i);s>3&&i&&Object.defineProperty(t,n,i)})([function(e,t,n){const o=n.value;n.value=function(...e){return(d?g(o):o).apply(this,e)}}],tt.prototype,"logImplementation",null),tt.prototype.ok=nt(Qe.ok),tt.prototype.debug=nt(Qe.debug),tt.prototype.info=nt(Qe.info),tt.prototype.notice=nt(Qe.notice),tt.prototype.warn=nt(Qe.warn),tt.prototype.error=nt(Qe.error),tt.prototype.critical=nt(Qe.critical),tt.prototype.alert=nt(Qe.alert),tt.prototype.emerg=nt(Qe.emerg);const at=URL;let ct,ut;function lt(){return ut||(ut=new D((e=>{if(!window.fetch)return;const{stop:t}=st(window,"fetch",(t=>function({parameters:e,onPostCall:t,handlingStack:n},o){const[r,s]=e;let i=s&&s.method;void 0===i&&r instanceof Request&&(i=r.method);const a=void 0!==i?String(i).toUpperCase():"GET",c=r instanceof Request?r.url:it(String(r)),u={state:"start",init:s,input:r,method:a,startClocks:Ee(),url:c,handlingStack:n};o.notify(u),e[0]=u.input,e[1]=u.init,t((e=>function(e,t,n){const o=n;function r(t){o.state="resolve",Object.assign(o,t),e.notify(o)}t.then(g((e=>{r({response:e,responseType:e.type,status:e.status,isAborted:!1})})),g((e=>{var t,n;r({status:0,isAborted:(null===(n=null===(t=o.init)||void 0===t?void 0:t.signal)||void 0===n?void 0:n.aborted)||e instanceof DOMException&&e.code===DOMException.ABORT_ERR,error:e})})))}(o,e,u)))}(t,e)),{computeHandlingStack:!0});return t}))),ut}function dt(e){return e?(parseInt(e,10)^16*Math.random()>>parseInt(e,10)/4).toString(16):"10000000-1000-4000-8000-100000000000".replace(/[018]/g,dt)}const ft=/([\w-]+)\s*=\s*([^;]+)/g;function pt(e,t,n=""){const o=e.charCodeAt(t-1),r=o>=55296&&o<=56319?t+1:t;return e.length<=r?e:`${e.slice(0,r)}${n}`}let gt,mt,ht;function yt(e,t,n=0,o){const r=new Date;r.setTime(r.getTime()+n);const s=`expires=${r.toUTCString()}`,i=o&&o.crossSite?"none":"strict",a=o&&o.domain?`;domain=${o.domain}`:"",c=o&&o.secure?";secure":"",u=o&&o.partitioned?";partitioned":"";document.cookie=`${e}=${t};${s};path=/;samesite=${i}${a}${c}${u}`}function bt(e){return function(e,t){for(ft.lastIndex=0;;){const n=ft.exec(e);if(!n)break;if(n[1]===t)return n[2]}}(document.cookie,e)}function vt(e){return mt||(mt=function(e){const t=new Map;for(ft.lastIndex=0;;){const n=ft.exec(e);if(!n)break;t.set(n[1],n[2])}return t}(document.cookie)),mt.get(e)}function wt(e,t){yt(e,"",0,t)}const St="_dd_s";function _t(e){return Object.values(e)}const Et=144e5,kt=9e5,Ct="cookie",xt="local-storage",Tt=/^([a-zA-Z]+)=([a-z0-9-]+)$/;function Lt(e,t){const n={isExpired:"1"};return t.trackAnonymousUser&&((null==e?void 0:e.anonymousId)?n.anonymousId=null==e?void 0:e.anonymousId:n.anonymousId=Math.floor(Math.random()*Math.pow(36,10)).toString(36).padStart(10,"0")),n}function $t(e){return I(e)}function It(e){return!$t(e)}function At(e){return void 0!==e.isExpired||!((void 0===(t=e).created||we()-Number(t.created)<Et)&&(void 0===t.expire||we()<Number(t.expire)));var t}function Ot(e){e.expire=String(we()+kt)}function Rt(e){return(t=e,Object.entries(t)).map((([e,t])=>"anonymousId"===e?`aid=${t}`:`${e}=${t}`)).join("&");var t}function Pt(e){const t={};return function(e){return!!e&&(-1!==e.indexOf("&")||Tt.test(e))}(e)&&e.split("&").forEach((e=>{const n=Tt.exec(e);if(null!==n){const[,e,o]=n;"aid"===e?t.anonymousId=o:t[e]=o}})),t}function Nt(e){const t=function(e){const t={};return t.secure=!!e.useSecureSessionCookie||!!e.usePartitionedCrossSiteSessionCookie,t.crossSite=!!e.usePartitionedCrossSiteSessionCookie,t.partitioned=!!e.usePartitionedCrossSiteSessionCookie,e.trackSessionAcrossSubdomains&&(t.domain=function(){if(void 0===ht){const e=`dd_site_test_${dt()}`,t="test",n=window.location.hostname.split(".");let o=n.pop();for(;n.length&&!bt(e);)o=`${n.pop()}.${o}`,yt(e,t,be,{domain:o});wt(e,{domain:o}),ht=o}return ht}()),t}(e);return function(e){if(void 0===document.cookie||null===document.cookie)return!1;try{const t=`dd_cookie_test_${dt()}`,n="test";yt(t,n,ve,e);const o=bt(t)===n;return wt(t,e),o}catch(e){return i.error(e),!1}}(t)?{type:Ct,cookieOptions:t}:void 0}function qt(){return Pt(bt(St))}function Mt(){try{const e=dt(),t=`_dd_test_${e}`;localStorage.setItem(t,e);const n=localStorage.getItem(t);return localStorage.removeItem(t),e===n?{type:xt}:void 0}catch(e){return}}function Ut(e){localStorage.setItem(St,Rt(e))}function Bt(){return Pt(localStorage.getItem(St))}const Dt=[];let jt;function Ft(e,t,n=0){var o;const{isLockEnabled:r,persistSession:s,expireSession:i}=t,a=e=>s({...e,lock:u}),c=()=>{const e=t.retrieveSession(),n=e.lock;return e.lock&&delete e.lock,{session:e,lock:n}};if(jt||(jt=e),e!==jt)return void Dt.push(e);if(r&&n>=100)return void Ht(t);let u,l=c();if(r){if(l.lock)return void zt(e,t,n);if(u=dt(),a(l.session),l=c(),l.lock!==u)return void zt(e,t,n)}let d=e.process(l.session);if(r&&(l=c(),l.lock!==u))zt(e,t,n);else{if(d&&(At(d)?i(d):(Ot(d),r?a(d):s(d))),r&&(!d||!At(d))){if(l=c(),l.lock!==u)return void zt(e,t,n);s(l.session),d=l.session}null===(o=e.after)||void 0===o||o.call(e,d||l.session),Ht(t)}}function zt(e,t,n){S((()=>{Ft(e,t,n+1)}),10)}function Ht(e){jt=void 0;const t=Dt.shift();t&&Ft(t,e)}const Gt=be;function Wt(e){switch(e.sessionPersistence){case Ct:return Nt(e);case xt:return Mt();case void 0:{let t=Nt(e);return!t&&e.allowFallbackToLocalStorage&&(t=Mt()),t}default:i.error(`Invalid session persistence '${String(e.sessionPersistence)}'`)}}function Jt(e,t,n,o){const r=new D,s=new D,i=new D,a=e.type===Ct?function(e,t){const n={isLockEnabled:0===(null!=gt?gt:gt=function(e=window){var t;const n=e.navigator.userAgent;return e.chrome||/HeadlessChrome/.test(n)?0:0===(null===(t=e.navigator.vendor)||void 0===t?void 0:t.indexOf("Apple"))||/safari/i.test(n)&&!/chrome|android/i.test(n)?1:2}()),persistSession:(o=t,e=>{yt(St,Rt(e),kt,o)}),retrieveSession:qt,expireSession:n=>function(e,t,n){const o=Lt(t,n);yt(St,Rt(o),n.trackAnonymousUser?31536e6:Et,e)}(t,n,e)};var o;return function(e){if(!vt(St)){const t=vt("_dd"),n=vt("_dd_r"),o=vt("_dd_l"),r={};t&&(r.id=t),o&&/^[01]$/.test(o)&&(r.logs=o),n&&/^[012]$/.test(n)&&(r.rum=n),It(r)&&(Ot(r),e.persistSession(r))}}(n),n}(t,e.cookieOptions):function(e){return{isLockEnabled:!1,persistSession:Ut,retrieveSession:Bt,expireSession:t=>function(e,t){Ut(Lt(e,t))}(t,e)}}(t),{expireSession:c}=a,u=E((function(){Ft({process:e=>At(e)?Lt(e,t):void 0,after:p},a)}),Gt);let l;g();const{throttled:d,cancel:f}=C((()=>{Ft({process:e=>{if($t(e))return;const t=p(e);return function(e){if($t(e))return!1;const{trackingType:t,isTracked:r}=o(e[n]);e[n]=t,delete e.isExpired,r&&!e.id&&(e.id=dt(),e.created=String(we()))}(t),t},after:e=>{It(e)&&!m()&&function(e){l=e,r.notify()}(e),l=e}},a)}),Gt);function p(e){return At(e)&&(e=Lt(e,t)),m()&&(function(e){return l.id!==e.id||l[n]!==e[n]}(e)?(l=Lt(l,t),s.notify()):(i.notify({previousState:l,newState:e}),l=e)),e}function g(){Ft({process:e=>{if($t(e))return Lt(e,t)},after:e=>{l=e}},a)}function m(){return void 0!==l[n]}return{expandOrRenewSession:d,expandSession:function(){Ft({process:e=>m()?p(e):void 0},a)},getSession:()=>l,renewObservable:r,expireObservable:s,sessionStateUpdateObservable:i,restartSession:g,expire:()=>{f(),c(l),p(Lt(l,t))},stop:()=>{k(u)},updateSessionState:function(e){Ft({process:t=>({...t,...e}),after:p},a)}}}function Vt(e,t,n){const o=function(e,t){const n=`/api/v2/${t}`,o=e.proxy;if("string"==typeof o){const e=it(o);return t=>`${e}?ddforward=${encodeURIComponent(`${n}?${t}`)}`}if("function"==typeof o)return e=>o({path:n,parameters:e});const r=function(e,t){const{site:n=he,internalAnalyticsSubdomain:o}=t;if("logs"===e&&t.usePciIntake&&n===he)return"pci.browser-intake-datadoghq.com";if(o&&n===he)return`${o}.${he}`;if("dd0g-gov.com"===n)return`http-intake.logs.${n}`;const r=n.split("."),s=r.pop();return`browser-intake-${r.join("-")}.${s}`}(t,e);return e=>`https://${r}${n}?${e}`}(e,t);return{build(r,s){const i=function({clientToken:e,internalAnalyticsSubdomain:t},n,o,r,{retry:s,encoding:i}){const a=["sdk_version:6.0.0",`api:${r}`].concat(o);s&&a.push(`retry_count:${s.count}`,`retry_after:${s.lastFailureStatus}`);const c=["ddsource=browser",`ddtags=${encodeURIComponent(a.join(","))}`,`dd-api-key=${e}`,`dd-evp-origin-version=${encodeURIComponent("6.0.0")}`,"dd-evp-origin=browser",`dd-request-id=${dt()}`];return i&&c.push(`dd-evp-encoding=${i}`),"rum"===n&&c.push(`batch_time=${Se()}`),t&&c.reverse(),c.join("&")}(e,t,n,r,s);return o(i)},urlPrefix:o(""),trackType:t}}function Kt(e,t){const n=200-e.length-1;return(t.length>n||function(e){return!!function(){try{return new RegExp("[\\p{Ll}]","u"),!0}catch(e){return!1}}()&&new RegExp("[^\\p{Ll}\\p{Lo}0-9_:./-]","u").test(e)}(t))&&i.warn(`${e} value doesn't meet tag requirements and will be sanitized. ${u} ${a}/getting_started/tagging/#defining-tags`),`${e}:${t.replace(/,/g,"_")}`}function Qt(e){const t=e.site||he,n=function(e){const{env:t,service:n,version:o,datacenter:r}=e,s=[];return t&&s.push(Kt("env",t)),n&&s.push(Kt("service",n)),o&&s.push(Kt("version",o)),r&&s.push(Kt("datacenter",r)),s}(e),o=function(e,t){return{logsEndpointBuilder:Vt(e,"logs",t),rumEndpointBuilder:Vt(e,"rum",t),sessionReplayEndpointBuilder:Vt(e,"replay",t)}}(e,n),r=function(e,t){if(!e.replica)return;const n={...e,site:he,clientToken:e.replica.clientToken},o={logsEndpointBuilder:Vt(n,"logs",t),rumEndpointBuilder:Vt(n,"rum",t)};return{applicationId:e.replica.applicationId,...o}}(e,n);return{replica:r,site:t,...o}}function Yt(e,t){return null==e||"string"==typeof e||(i.error(`${t} must be defined as a string`),!1)}function Xt(e,t){return!!(void 0===e||(n=e,function(e){return"number"==typeof e}(n)&&n>=0&&n<=100))||(i.error(`${t} Sample Rate should be a number between 0 and 100`),!1);var n}const Zt={intervention:"intervention",deprecation:"deprecation",cspViolation:"csp_violation"};function en(e){return{startClocks:Ee(),source:Ve,handling:"unhandled",...e}}function tn(e,t,n,o,r){return n?ae({name:e,message:t,stack:[{func:"?",url:n,line:null!=o?o:void 0,column:null!=r?r:void 0}]}):void 0}function nn(e,t,n){return void 0===e?[]:"all"===e||Array.isArray(e)&&e.every((e=>t.includes(e)))?"all"===e?t:function(e){const t=new Set;return e.forEach((e=>t.add(e))),Array.from(t)}(e):void i.error(`${n} should be "all" or an array with allowed values "${t.join('", "')}"`)}function on(e,t,o){const r=Ie();let s,c;const d=t.observable.subscribe(f);function f(){if(!c||!s||!t.isGranted())return;d.unsubscribe();const e=o(s,c);r.drain(e)}return{init(e){if(!e)return void i.error("Missing configuration");if(o=e.enableExperimentalFeatures,Array.isArray(o)&&o.filter((e=>$(ge,e))).forEach((e=>{me.add(e)})),rt()&&(e=function(e){return{...e,clientToken:"empty"}}(e)),s=e,c)return void ze("DD_LOGS",e);var o;const r=function(e){!0===e.usePciIntake&&e.site&&"datadoghq.com"!==e.site&&i.warn("PCI compliance for Logs is only available for Datadog organizations in the US1 site. Default intake will be used.");const t=function(e){var t,n,o,r,s,c;if(e&&e.clientToken){if((!(d=e.site)||"string"!=typeof d||/(datadog|ddog|datad0g|dd0g)/.test(d)||(i.error(`Site should be a valid Datadog site. ${u} ${a}/getting_started/site/.`),0))&&Xt(e.sessionSampleRate,"Session")&&Xt(e.telemetrySampleRate,"Telemetry")&&Xt(e.telemetryConfigurationSampleRate,"Telemetry Configuration")&&Xt(e.telemetryUsageSampleRate,"Telemetry Usage")&&Yt(e.version,"Version")&&Yt(e.env,"Env")&&Yt(e.service,"Service")){var d;if(void 0===e.trackingConsent||$(z,e.trackingConsent))return{beforeSend:e.beforeSend&&l(e.beforeSend,"beforeSend threw an error:"),sessionStoreStrategyType:Wt(e),sessionSampleRate:null!==(t=e.sessionSampleRate)&&void 0!==t?t:100,telemetrySampleRate:null!==(n=e.telemetrySampleRate)&&void 0!==n?n:20,telemetryConfigurationSampleRate:null!==(o=e.telemetryConfigurationSampleRate)&&void 0!==o?o:5,telemetryUsageSampleRate:null!==(r=e.telemetryUsageSampleRate)&&void 0!==r?r:5,service:e.service||void 0,silentMultipleInit:!!e.silentMultipleInit,allowUntrustedEvents:!!e.allowUntrustedEvents,trackingConsent:null!==(s=e.trackingConsent)&&void 0!==s?s:z.GRANTED,trackAnonymousUser:null===(c=e.trackAnonymousUser)||void 0===c||c,storeContextsAcrossPages:!!e.storeContextsAcrossPages,batchBytesLimit:16384,eventRateLimiterThreshold:3e3,maxTelemetryEventsPerPage:15,flushTimeout:3e4,batchMessagesLimit:50,messageBytesLimit:262144,...Qt(e)};i.error('Tracking Consent should be either "granted" or "not-granted"')}}else i.error("Client Token is not configured, we will not send any data.")}(e),o=nn(e.forwardConsoleLogs,_t(n),"Forward Console Logs"),r=nn(e.forwardReports,_t(Zt),"Forward Reports");if(t&&o&&r)return e.forwardErrorsToLogs&&!o.includes(n.error)&&o.push(n.error),{forwardErrorsToLogs:!1!==e.forwardErrorsToLogs,forwardConsoleLogs:o,forwardReports:r,requestErrorResponseLengthLimit:32768,...t}}(e);r&&(c=r,lt().subscribe(x),t.tryToInit(r.trackingConsent),f())},get initConfiguration(){return s},getInternalContext:x,handleLog(t,n,o,s=e(),i=Se()){r.add((e=>e.handleLog(t,n,o,s,i)))}}}const rn="logs",sn={HIDDEN:"visibility_hidden",UNLOADING:"before_unload",PAGEHIDE:"page_hide",FROZEN:"page_frozen"};function an(){return Boolean(window._DATADOG_SYNTHETICS_INJECTS_RUM||vt("datadog-synthetics-injects-rum"))}function cn(){const e=window._DATADOG_SYNTHETICS_PUBLIC_ID||vt("datadog-synthetics-public-id");return"string"==typeof e?e:void 0}function un(){const e=window._DATADOG_SYNTHETICS_RESULT_ID||vt("datadog-synthetics-result-id");return"string"==typeof e?e:void 0}const ln=1/0;const dn=Et;let fn=[];function pn(e,t,n,o){const r=new D,s=new D,i=Jt(e.sessionStoreStrategyType,e,t,n);fn.push((()=>i.stop()));const a=function({expireDelay:e,maxEntries:t}){let n=[];const o=E((()=>function(){const t=_e()-e;for(;n.length>0&&n[n.length-1].endTime<t;)n.pop()}()),6e4);return{add:function(e,o){const r={value:e,startTime:o,endTime:ln,remove:()=>{$e(n,r)},close:e=>{r.endTime=e}};return t&&n.length>=t&&n.pop(),n.unshift(r),r},find:function(e=1/0,t={returnInactive:!1}){for(const o of n)if(o.startTime<=e){if(t.returnInactive||e<=o.endTime)return o.value;break}},closeActive:function(e){const t=n[0];t&&t.endTime===ln&&t.close(e)},findAll:function(e=1/0,t=0){const o=e+t;return n.filter((t=>t.startTime<=o&&e<=t.endTime)).map((e=>e.value))},reset:function(){n=[]},stop:function(){k(o)}}}({expireDelay:dn});function c(){return{id:i.getSession().id,trackingType:i.getSession()[t],isReplayForced:!!i.getSession().forcedReplay,anonymousId:i.getSession().anonymousId}}return fn.push((()=>a.stop())),i.renewObservable.subscribe((()=>{a.add(c(),_e()),r.notify()})),i.expireObservable.subscribe((()=>{s.notify(),a.closeActive(_e())})),i.expandOrRenewSession(),a.add(c(),[0,Ce()][0]),o.observable.subscribe((()=>{o.isGranted()?i.expandOrRenewSession():i.expire()})),function(e){const{stop:t}=G(e,window,["click","touchstart","keydown","scroll"],(()=>{o.isGranted()&&i.expandOrRenewSession()}),{capture:!0,passive:!0});fn.push(t)}(e),function(e){const t=()=>{"visible"===document.visibilityState&&i.expandSession()},{stop:n}=H(e,document,"visibilitychange",t);fn.push(n);const o=E(t,6e4);fn.push((()=>{k(o)}))}(e),function(e){const{stop:t}=H(e,window,"resume",(()=>i.restartSession()),{capture:!0});fn.push(t)}(e),{findSession:(e,t)=>a.find(e,t),renewObservable:r,expireObservable:s,sessionStateUpdateObservable:i.sessionStateUpdateObservable,expire:i.expire,updateSessionState:i.updateSessionState}}function gn(e){return Te(e.sessionSampleRate)?"1":"0"}let mn=!1;function hn(e){const t=window;if(an()){const e=n(t.DD_RUM_SYNTHETICS);return e||mn||(mn=!0,Ue("Logs sent before RUM is injected by the synthetics worker",{testId:cn(),resultId:un()})),e}return n(t.DD_RUM);function n(t){if(t&&t.getInternalContext)return t.getInternalContext(e)}}function yn(e,t,n,o,r){const s=et.concat(["custom"]),i={};s.forEach((e=>{i[e]=function(e,t,n){let o=0,r=!1;return{isLimitReached(){if(0===o&&S((()=>{o=0}),ve),o+=1,o<=t||r)return r=!1,!1;if(o===t+1){r=!0;try{n({message:`Reached max number of ${e}s by minute: ${t}`,source:He,startClocks:Ee()})}finally{r=!1}}return!0}}}(e,t.eventRateLimiterThreshold,r)})),n.subscribe(0,(({rawLogsEvent:r,messageContext:s,savedCommonContext:a,domainContext:c})=>{var u,l;const d=r.date-Ce(),f=e.findTrackedSession(d);if(!e.findTrackedSession(d,{returnInactive:!0}))return;const p=a||o();f&&f.anonymousId&&!p.user.anonymous_id&&(p.user.anonymous_id=f.anonymousId);const g=N({service:t.service,session_id:f?f.id:void 0,session:f?{id:f.id}:void 0,usr:I(p.user)?void 0:p.user,view:p.view},p.context,hn(d),r,s);!1===(null===(u=t.beforeSend)||void 0===u?void 0:u.call(t,g,c))||g.origin!==He&&(null!==(l=i[g.status])&&void 0!==l?l:i.custom).isLimitReached()||n.notify(1,g)}))}let bn={};const vn={[n.log]:Qe.info,[n.debug]:Qe.debug,[n.info]:Qe.info,[n.warn]:Qe.warn,[n.error]:Qe.error};let wn;const Sn=new WeakMap;function _n({target:e,parameters:[t,n]}){Sn.set(e,{state:"open",method:String(t).toUpperCase(),url:it(String(n))})}function En({target:e}){const t=Sn.get(e);t&&(t.isAborted=!0)}function kn(e){return e>=500}function Cn(e,t){if(!e.forwardErrorsToLogs)return{stop:x};const n=function(e){return wn||(wn=function(e){return new D((t=>{const{stop:n}=st(XMLHttpRequest.prototype,"open",_n),{stop:o}=st(XMLHttpRequest.prototype,"send",(n=>{!function({target:e,handlingStack:t},n,o){const r=Sn.get(e);if(!r)return;const s=r;s.state="start",s.startClocks=Ee(),s.isAborted=!1,s.xhr=e,s.handlingStack=t;let i=!1;const{stop:a}=st(e,"onreadystatechange",(()=>{e.readyState===XMLHttpRequest.DONE&&c()})),c=()=>{if(u(),a(),i)return;i=!0;const t=r;var n,c;t.state="complete",t.duration=(n=s.startClocks.timeStamp,Se()-n),t.status=e.status,o.notify((c=t,{...c}))},{stop:u}=H(n,e,"loadend",c);o.notify(s)}(n,e,t)}),{computeHandlingStack:!0}),{stop:r}=st(XMLHttpRequest.prototype,"abort",En);return()=>{n(),o(),r()}}))}(e)),wn}(e).subscribe((e=>{"complete"===e.state&&r("xhr",e)})),o=lt().subscribe((e=>{"resolve"===e.state&&r("fetch",e)}));function r(n,o){var r;function s(e){const r={isAborted:o.isAborted,handlingStack:o.handlingStack};t.notify(0,{rawLogsEvent:{message:`${Tn(n)} error ${o.method} ${o.url}`,date:o.startClocks.timeStamp,error:{stack:e||"Failed to load",handling:void 0},http:{method:o.method,status_code:o.status,url:o.url},status:Qe.error,origin:"network"},domainContext:r})}r=o.url,ye.every((e=>r.includes(e)))||!function(e){return 0===e.status&&"opaque"!==e.responseType}(o)&&!kn(o.status)||("xhr"in o?function(e,t,n){"string"==typeof e.response?n(xn(e.response,t)):n(e.response)}(o.xhr,e,s):o.response?function(e,t,n){const o=function(e){try{return e.clone()}catch(e){return}}(e);o&&o.body?window.TextDecoder?function(e,t,n){!function(e,t,n){const o=e.getReader(),r=[];let s=0;function i(){let e,i;if(o.cancel().catch(x),n.collectStreamBody){let t;if(1===r.length)t=r[0];else{t=new Uint8Array(s);let e=0;r.forEach((n=>{t.set(n,e),e+=n.length}))}e=t.slice(0,n.bytesLimit),i=t.length>n.bytesLimit}t(void 0,e,i)}!function e(){o.read().then(g((t=>{t.done?i():(n.collectStreamBody&&r.push(t.value),s+=t.value.length,s>n.bytesLimit?i():e())})),g((e=>t(e))))}()}(e,((e,t,o)=>{if(e)n(e);else{let e=(new TextDecoder).decode(t);o&&(e+="..."),n(void 0,e)}}),{bytesLimit:t,collectStreamBody:!0})}(o.body,t.requestErrorResponseLengthLimit,((e,t)=>{n(e?`Unable to retrieve response: ${e}`:t)})):o.text().then(g((e=>n(xn(e,t)))),g((e=>n(`Unable to retrieve response: ${e}`)))):n()}(o.response,e,s):o.error&&function(e,t,n){n(xn(ae(K(e)),t))}(o.error,e,s))}return{stop:()=>{n.unsubscribe(),o.unsubscribe()}}}function xn(e,t){return e.length>t.requestErrorResponseLengthLimit?`${e.substring(0,t.requestErrorResponseLengthLimit)}...`:e}function Tn(e){return"xhr"===e?"XHR":"Fetch"}function Ln(e){const t=(t,n)=>{const o=le({stackTrace:t,originalError:n,startClocks:Ee(),nonErrorPrefix:"Uncaught",source:Je,handling:"unhandled"});e.notify(o)},{stop:n}=(o=t,st(window,"onerror",(({parameters:[e,t,n,r,s]})=>{let i;i=fe(s)?K(s):function(e,t,n,o){const r=[{url:t,column:o,line:n}],{name:s,message:i}=function(e){let t,n;return"[object String]"==={}.toString.call(e)&&([,t,n]=se.exec(e)),{name:t,message:n}}(e);return{name:s,message:i,stack:r}}(e,t,n,r),o(i,null!=s?s:e)})));var o;const{stop:r}=function(e){return st(window,"onunhandledrejection",(({parameters:[t]})=>{const n=t.reason||"Empty reason",o=K(n);e(o,n)}))}(t);return{stop:()=>{n(),r()}}}const $n=class{constructor(){this.callbacks={}}notify(e,t){const n=this.callbacks[e];n&&n.forEach((e=>e(t)))}subscribe(e,t){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t),{unsubscribe:()=>{this.callbacks[e]=this.callbacks[e].filter((e=>t!==e))}}}};const In={[Qe.ok]:n.debug,[Qe.debug]:n.debug,[Qe.info]:n.info,[Qe.notice]:n.info,[Qe.warn]:n.warn,[Qe.error]:n.error,[Qe.critical]:n.error,[Qe.alert]:n.error,[Qe.emerg]:n.error};function An({encoder:e,request:t,flushController:n,messageBytesLimit:o}){let r={};const s=n.flushObservable.subscribe((n=>function(n){const o=_t(r).join("\n");r={};const s=(a=n.reason,_t(sn).includes(a)),i=s?t.sendOnExit:t.send;var a;if(s&&e.isAsync){const t=e.finishSync();t.outputBytesCount&&i(On(t));const n=[t.pendingData,o].filter(Boolean).join("\n");n&&i({data:n,bytesCount:v(n)})}else o&&e.write(e.isEmpty?o:`\n${o}`),e.finish((e=>{i(On(e))}))}(n)));function a(t,s){const a=T(t),l=e.estimateEncodedBytesCount(a);l>=o?i.warn(`Discarded a message whose size was bigger than the maximum allowed size ${o}KB. ${u} ${c}/#technical-limitations`):(function(e){return void 0!==e&&void 0!==r[e]}(s)&&function(t){const o=r[t];delete r[t];const s=e.estimateEncodedBytesCount(o);n.notifyAfterRemoveMessage(s)}(s),function(t,o,s){n.notifyBeforeAddMessage(o),void 0!==s?(r[s]=t,n.notifyAfterAddMessage()):e.write(e.isEmpty?t:`\n${t}`,(e=>{n.notifyAfterAddMessage(e-o)}))}(a,l,s))}return{flushController:n,add:a,upsert:a,stop:s.unsubscribe}}function On(e){let t;return t="string"==typeof e.output?e.output:new Blob([e.output],{type:"text/plain"}),{data:t,bytesCount:e.outputBytesCount,encoding:e.encoding}}const Rn=be;function Pn(e,t,n,o,r){0===t.transportStatus&&0===t.queuedPayloads.size()&&t.bandwidthMonitor.canHandle(e)?qn(e,t,n,{onSuccess:()=>Mn(0,t,n,o,r),onFailure:()=>{t.queuedPayloads.enqueue(e),Nn(t,n,o,r)}}):t.queuedPayloads.enqueue(e)}function Nn(e,t,n,o){2===e.transportStatus&&S((()=>{qn(e.queuedPayloads.first(),e,t,{onSuccess:()=>{e.queuedPayloads.dequeue(),e.currentBackoffTime=Rn,Mn(1,e,t,n,o)},onFailure:()=>{e.currentBackoffTime=Math.min(6e4,2*e.currentBackoffTime),Nn(e,t,n,o)}})}),e.currentBackoffTime)}function qn(e,t,n,{onSuccess:o,onFailure:r}){t.bandwidthMonitor.add(e),n(e,(n=>{t.bandwidthMonitor.remove(e),function(e){return"opaque"!==e.type&&(0===e.status&&!navigator.onLine||408===e.status||429===e.status||kn(e.status))}(n)?(t.transportStatus=t.bandwidthMonitor.ongoingRequestCount>0?1:2,e.retry={count:e.retry?e.retry.count+1:1,lastFailureStatus:n.status},r()):(t.transportStatus=0,o())}))}function Mn(e,t,n,o,r){0===e&&t.queuedPayloads.isFull()&&!t.queueFullReported&&(r({message:`Reached max ${o} events size queued for upload: 3MiB`,source:He,startClocks:Ee()}),t.queueFullReported=!0);const s=t.queuedPayloads;for(t.queuedPayloads=Un();s.size()>0;)Pn(s.dequeue(),t,n,o,r)}function Un(){const e=[];return{bytesCount:0,enqueue(t){this.isFull()||(e.push(t),this.bytesCount+=t.bytesCount)},first:()=>e[0],dequeue(){const t=e.shift();return t&&(this.bytesCount-=t.bytesCount),t},size:()=>e.length,isFull(){return this.bytesCount>=3145728}}}function Bn(e,t,n){const o={transportStatus:0,currentBackoffTime:Rn,bandwidthMonitor:{ongoingRequestCount:0,ongoingByteCount:0,canHandle(e){return 0===this.ongoingRequestCount||this.ongoingByteCount+e.bytesCount<=81920&&this.ongoingRequestCount<32},add(e){this.ongoingRequestCount+=1,this.ongoingByteCount+=e.bytesCount},remove(e){this.ongoingRequestCount-=1,this.ongoingByteCount-=e.bytesCount}},queuedPayloads:Un(),queueFullReported:!1},r=(n,o)=>function(e,t,n,o){if(function(){try{return window.Request&&"keepalive"in new Request("http://a")}catch(e){return!1}}()&&n.bytesCount<t){const t=e.build("fetch",n);fetch(t,{method:"POST",body:n.data,keepalive:!0,mode:"cors"}).then(g((e=>null==o?void 0:o({status:e.status,type:e.type}))),g((()=>{jn(e.build("xhr",n),n.data,o)})))}else jn(e.build("xhr",n),n.data,o)}(e,t,n,o);return{send:t=>{Pn(t,o,r,e.trackType,n)},sendOnExit:n=>{!function(e,t,n){if(!!navigator.sendBeacon&&n.bytesCount<t)try{const t=e.build("beacon",n);if(navigator.sendBeacon(t,n.data))return}catch(e){!function(e){Dn||(Dn=!0,Be(e))}(e)}jn(e.build("xhr",n),n.data)}(e,t,n)}}}let Dn=!1;function jn(e,t,n){const o=new XMLHttpRequest;o.open("POST",e,!0),t instanceof Blob&&o.setRequestHeader("Content-Type",t.type),H({allowUntrustedEvents:!0},o,"loadend",(()=>{null==n||n({status:o.status})}),{once:!0}),o.send(t)}function Fn({messagesLimit:e,bytesLimit:t,durationLimit:n,pageExitObservable:o,sessionExpireObservable:r}){const s=o.subscribe((e=>d(e.reason))),i=r.subscribe((()=>d("session_expire"))),a=new D((()=>()=>{s.unsubscribe(),i.unsubscribe()}));let c,u=0,l=0;function d(e){if(0===l)return;const t=l,n=u;l=0,u=0,f(),a.notify({reason:e,messagesCount:t,bytesCount:n})}function f(){_(c),c=void 0}return{flushObservable:a,get messagesCount(){return l},notifyBeforeAddMessage(e){u+e>=t&&d("bytes_limit"),l+=1,u+=e,void 0===c&&(c=S((()=>{d("duration_limit")}),n))},notifyAfterAddMessage(n=0){u+=n,l>=e?d("messages_limit"):u>=t&&d("bytes_limit")},notifyAfterRemoveMessage(e){u-=e,l-=1,0===l&&f()}}}function zn(e,t,n,o,r,s,i=An){const a=u(e,t),c=n&&u(e,n);function u(e,{endpoint:t,encoder:n}){return i({encoder:n,request:Bn(t,e.batchBytesLimit,o),flushController:Fn({messagesLimit:e.batchMessagesLimit,bytesLimit:e.batchBytesLimit,durationLimit:e.flushTimeout,pageExitObservable:r,sessionExpireObservable:s}),messageBytesLimit:e.messageBytesLimit})}return{flushObservable:a.flushController.flushObservable,add(e,t=!0){a.add(e),c&&t&&c.add(n.transformMessage?n.transformMessage(e):e)},upsert:(e,t)=>{a.upsert(e,t),c&&c.upsert(n.transformMessage?n.transformMessage(e):e,t)},stop:()=>{a.stop(),c&&c.stop()}}}function Hn(){let e="",t=0;return{isAsync:!1,get isEmpty(){return!e},write(n,o){const r=v(n);t+=r,e+=n,o&&o(r)},finish(e){e(this.finishSync())},finishSync(){const n={output:e,outputBytesCount:t,rawBytesCount:t,pendingData:""};return e="",t=0,n},estimateEncodedBytesCount:e=>e.length}}function Gn(e,t,n,o,r){const s=function(e,t){let n;const o=new D,r=new Set,s=!Ne.includes(t.site)&&Te(t.telemetrySampleRate),i={[Ae]:s,[Oe]:s&&Te(t.telemetryConfigurationSampleRate),[Re]:s&&Te(t.telemetryUsageSampleRate)},a={is_local_file:"file:"===window.location.protocol,is_worker:"WorkerGlobalScope"in self};return Me=s=>{const c=T(s);if(i[s.type]&&r.size<t.maxTelemetryEventsPerPage&&!r.has(c)){const t=function(e,t,o){return N({type:"telemetry",date:Se(),service:e,version:"6.0.0",source:"browser",_dd:{format_version:2},telemetry:N(t,{runtime_env:o,connectivity:Le(),sdk_setup:"npm"}),experimental_features:Array.from(me)},void 0!==n?n():{})}(e,s,a);o.notify(t),xe("telemetry",t),r.add(c)}},d=Be,{setContextProvider:e=>{n=e},observable:o,enabled:s}}("browser-logs-sdk",t);s.setContextProvider((()=>{var e,t,n,o,s,i;return{application:{id:null===(e=hn())||void 0===e?void 0:e.application_id},session:{id:null===(t=r.findTrackedSession())||void 0===t?void 0:t.id},view:{id:null===(o=null===(n=hn())||void 0===n?void 0:n.view)||void 0===o?void 0:o.id},action:{id:null===(i=null===(s=hn())||void 0===s?void 0:s.user_action)||void 0===i?void 0:i.id}}}));const i=[];if(rt()){const e=ot(),t=s.observable.subscribe((t=>e.send("internal_telemetry",t)));i.push((()=>t.unsubscribe()))}else{const e=zn(t,{endpoint:t.rumEndpointBuilder,encoder:Hn()},t.replica&&{endpoint:t.replica.rumEndpointBuilder,encoder:Hn()},n,o,r.expireObservable);i.push((()=>e.stop()));const a=s.observable.subscribe((n=>e.add(n,function(e){return"datad0g.com"===e.site}(t))));i.push((()=>a.unsubscribe()))}return qe.drain(),function(e){Me({type:Oe,configuration:e})}(function(e){const t={session_sample_rate:(n=e).sessionSampleRate,telemetry_sample_rate:n.telemetrySampleRate,telemetry_configuration_sample_rate:n.telemetryConfigurationSampleRate,telemetry_usage_sample_rate:n.telemetryUsageSampleRate,use_before_send:!!n.beforeSend,use_partitioned_cross_site_session_cookie:n.usePartitionedCrossSiteSessionCookie,use_secure_session_cookie:n.useSecureSessionCookie,use_proxy:!!n.proxy,silent_multiple_init:n.silentMultipleInit,track_session_across_subdomains:n.trackSessionAcrossSubdomains,track_anonymous_user:n.trackAnonymousUser,session_persistence:n.sessionPersistence,allow_fallback_to_local_storage:!!n.allowFallbackToLocalStorage,store_contexts_across_pages:!!n.storeContextsAcrossPages,allow_untrusted_events:!!n.allowUntrustedEvents,tracking_consent:n.trackingConsent};var n;return{forward_errors_to_logs:e.forwardErrorsToLogs,forward_console_logs:e.forwardConsoleLogs,forward_reports:e.forwardReports,use_pci_intake:e.usePciIntake,...t}}(e)),{telemetry:s,stop:()=>{i.forEach((e=>e()))}}}const Wn=function(){const e=function(e=2){const t=new Map;let n=!1;function o(o=0){if(n||0===e)return;const r=2===e?3072:16384;let s=o;t.forEach((e=>{s+=e.getBytesCount()})),s>r&&(function(e){i.warn(`Customer data exceeds the recommended ${e/1024}KiB threshold. ${u} ${c}/#customer-data-exceeds-the-recommended-threshold-warning`)}(r),n=!0)}return{createDetachedTracker:()=>{const e=A((()=>o(e.getBytesCount())));return e},getOrCreateTracker:e=>(t.has(e)||t.set(e,A(o)),t.get(e)),setCompressionStatus:t=>{0===e&&(e=t,o())},getCompressionStatus:()=>e,stop:()=>{t.forEach((e=>e.stop())),t.clear()}}}(),t=F(e.getOrCreateTracker(2)),s=F(e.getOrCreateTracker(1)),a=function(e){const t=new D;return{tryToInit(t){e||(e=t)},update(n){e=n,t.notify()},isGranted:()=>e===z.GRANTED,observable:t}}();function l(){return function(e,t){return{view:{referrer:document.referrer,url:window.location.href},context:e.getContext(),user:t.getContext()}}(t,s)}let d=on(l,a,((e,i)=>{e.storeContextsAcrossPages&&(J(i,t,rn,2),J(i,s,rn,1));const c=function(e,t,s,i){const a=new $n,c=[];a.subscribe(1,(e=>xe("logs",e)));const u=function(e){return t=>{e.notify(0,{rawLogsEvent:{message:t.message,date:t.startClocks.timeStamp,origin:He,status:Qe.error}}),Ue("Error reported to customer",{"error.message":t.message})}}(a),l=function(e){return new D((t=>{const{stop:n}=G(e,window,["visibilitychange","freeze"],(e=>{"visibilitychange"===e.type&&"hidden"===document.visibilityState?t.notify({reason:sn.HIDDEN}):"freeze"===e.type&&t.notify({reason:sn.FROZEN})}),{capture:!0}),o=H(e,window,"beforeunload",(()=>{t.notify({reason:sn.UNLOADING})})).stop;return()=>{n(),o()}}))}(t),d=!t.sessionStoreStrategyType||rt()||an()?function(e){const t="1"===gn(e)?{}:void 0;return{findTrackedSession:()=>t,expireObservable:new D}}(t):function(e,t){const n=pn(e,"logs",(t=>function(e,t){const n=function(e){return"0"===e||"1"===e}(t)?t:gn(e);return{trackingType:n,isTracked:"1"===n}}(e,t)),t);return{findTrackedSession:(e,t={returnInactive:!1})=>{const o=n.findSession(e,t);return o&&"1"===o.trackingType?{id:o.id,anonymousId:o.anonymousId}:void 0},expireObservable:n.expireObservable}}(t,i),{stop:f}=Gn(e,t,u,l,d);c.push((()=>f())),Cn(t,a),function(e,t){if(!e.forwardErrorsToLogs)return{stop:x};const n=new D,{stop:o}=Ln(n);n.subscribe((e=>{t.notify(0,{rawLogsEvent:{message:e.message,date:e.startClocks.timeStamp,error:Xe(e),origin:Je,status:Qe.error}})}))}(t,a),function(e,t){(r=e.forwardConsoleLogs,j(...r.map((e=>(bn[e]||(bn[e]=function(e){return new D((t=>{const r=o[e];return o[e]=(...o)=>{r.apply(console,o);const s=ie();m((()=>{t.notify(function(e,t,o){const r=e.map((e=>function(e){return"string"==typeof e?q(e):fe(e)?ce(K(e)):T(q(e),void 0,2)}(e))).join(" ");let s;if(t===n.error){const t=e.find(fe);s={stack:t?ae(K(t)):void 0,fingerprint:de(t),causes:t?pe(t,"console"):void 0,startClocks:Ee(),message:r,source:Ge,handling:"handled",handlingStack:o}}return{api:t,message:r,error:s,handlingStack:o}}(o,e,s))}))},()=>{o[e]=r}}))}(e)),bn[e]))))).subscribe((e=>{const n={rawLogsEvent:{date:Se(),message:e.message,origin:Ge,error:e.error&&Xe(e.error),status:vn[e.api]},domainContext:{handlingStack:e.handlingStack}};t.notify(0,n)}));var r}(t,a),function(e,t){(function(e,t){const n=[];t.includes(Zt.cspViolation)&&n.push(function(e){return new D((t=>{const{stop:n}=H(e,document,"securitypolicyviolation",(e=>{t.notify(function(e){const t=`'${e.blockedURI}' blocked by '${e.effectiveDirective}' directive`;return en({type:e.effectiveDirective,message:`${Zt.cspViolation}: ${t}`,originalError:e,csp:{disposition:e.disposition},stack:tn(e.effectiveDirective,e.originalPolicy?`${t} of the policy "${pt(e.originalPolicy,100,"...")}"`:"no policy",e.sourceFile,e.lineNumber,e.columnNumber)})}(e))}));return n}))}(e));const o=t.filter((e=>e!==Zt.cspViolation));return o.length&&n.push(function(e){return new D((t=>{if(!window.ReportingObserver)return;const n=g(((e,n)=>e.forEach((e=>t.notify(function(e){const{type:t,body:n}=e;return en({type:n.id,message:`${t}: ${n.message}`,originalError:e,stack:tn(n.id,n.message,n.sourceFile,n.lineNumber,n.columnNumber)})}(e)))))),o=new window.ReportingObserver(n,{types:e,buffered:!0});return o.observe(),()=>{o.disconnect()}}))}(o)),j(...n)})(e,e.forwardReports).subscribe((e=>{let n,o=e.message;const r="deprecation"===e.originalError.type?Qe.warn:Qe.error;var s,i;r===Qe.error?n=Xe(e):e.stack&&(o+=` Found in ${s=e.stack,null===(i=/@ (.+)/.exec(s))||void 0===i?void 0:i[1]}`),t.notify(0,{rawLogsEvent:{date:Se(),message:o,origin:Ve,error:n,status:r}})}))}(t,a);const{handleLog:p}=function(e){return{handleLog:function(t,n,s,i,a){const c=N(n.getContext(),t.context);if(Ke(t.status,"console",n)&&function({status:e,message:t},n){r[In[e]].call(o,t,n)}(t,c),Ke(t.status,Ze,n)){const n={rawLogsEvent:{date:a||Se(),message:t.message,status:t.status,origin:We},messageContext:c,savedCommonContext:i};s&&(n.domainContext={handlingStack:s}),e.notify(0,n)}}}}(a);if(yn(d,t,a,s,u),rt())!function(e){const t=ot();e.subscribe(1,(e=>{t.send("log",e)}))}(a);else{const{stop:e}=function(e,t,n,o,r){const s=zn(e,{endpoint:e.logsEndpointBuilder,encoder:Hn()},e.replica&&{endpoint:e.replica.logsEndpointBuilder,encoder:Hn()},n,o,r.expireObservable);return t.subscribe(1,(e=>{s.add(e)})),s}(t,a,u,l,d);c.push((()=>e()))}var h;return{handleLog:p,getInternalContext:(h=d,{get:e=>{const t=h.findTrackedSession(e);if(t)return{session_id:t.id}}}).get,stop:()=>{c.forEach((e=>e()))}}}(e,i,l,a);return d=function(e,t){return{init:e=>{ze("DD_LOGS",e)},initConfiguration:e,...t}}(e,c),c}));const f={};return function(e){const t={version:"6.0.0",onReady(e){e()},...e};return Object.defineProperty(t,"_setDebug",{get:()=>p,enumerable:!1}),t}({logger:new tt(((...e)=>d.handleLog(...e)),e.createDetachedTracker()),init:g((e=>d.init(e))),setTrackingConsent:g((e=>{a.update(e),Me({type:Re,usage:{feature:"set-tracking-consent",tracking_consent:e}})})),getGlobalContext:g((()=>t.getContext())),setGlobalContext:g((e=>t.setContext(e))),setGlobalContextProperty:g(((e,n)=>t.setContextProperty(e,n))),removeGlobalContextProperty:g((e=>t.removeContextProperty(e))),clearGlobalContext:g((()=>t.clearContext())),createLogger:g(((t,n={})=>(f[t]=new tt(((...e)=>d.handleLog(...e)),e.createDetachedTracker(),q(t),n.handler,n.level,q(n.context)),f[t]))),getLogger:g((e=>f[e])),getInitConfiguration:g((()=>P(d.initConfiguration))),getInternalContext:g((e=>d.getInternalContext(e))),setUser:g((e=>{(function(e){const t="object"===O(e);return t||i.error("Unsupported user:",e),t})(e)&&s.setContext(Fe(e))})),getUser:g((()=>s.getContext())),setUserProperty:g(((e,t)=>{const n=Fe({[e]:t})[e];s.setContextProperty(e,n)})),removeUserProperty:g((e=>s.removeContextProperty(e))),clearUser:g((()=>s.clearContext()))})}();!function(e,t,n){const o=e[t];o&&!o.q&&o.version&&i.warn("SDK is loaded more than once. This is unsupported and might have unexpected behavior."),e[t]=n,o&&o.q&&o.q.forEach((e=>l(e,"onReady callback threw an error:")()))}(y(),"DD_LOGS",Wn);var Jn=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((o=o.apply(e,t||[])).next())}))};const Vn=new class{constructor(e){this.baseUrl=e}isHealthy(){return Jn(this,void 0,void 0,(function*(){const e=`${this.baseUrl}/health/ping`,t=yield fetch(e);return!(!t.ok||"pong"!==(yield t.text()))}))}getDebugConfig(){return Jn(this,void 0,void 0,(function*(){return function(e){return Jn(this,void 0,void 0,(function*(){const t=yield fetch(e,undefined);if(!t.ok)throw new Error(`API request failed: ${t.status} ${t.statusText}`);return t.json()}))}(`${this.baseUrl}/api/v1/debug/config`)}))}postDebugBundle(e){return Jn(this,void 0,void 0,(function*(){const t=`${this.baseUrl}/api/v1/debug/bundle`,n={method:"POST",headers:{"Content-Type":"text/plain"},body:function(e){return"function"==typeof e.then}(e)?yield e:e},o=yield fetch(t,n);if(!o.ok)throw new Error(`API request failed: ${o.status} ${o.statusText}`);return o.text()}))}}("https://quiz-loader-production.fly.dev");var Kn;!function(e){e.DEBUG="canvas-quiz-loader-debug",e.PING="canvas-quiz-loader-ping",e.PONG="canvas-quiz-loader-pong"}(Kn||(Kn={}));var Qn=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((o=o.apply(e,t||[])).next())}))};class Yn{constructor(){this.logs=[],this.debugConfig={excludeErrorPattern:[],saveBundleErrorPattern:[]},this.logs=[],this.initDd=this.initDd.bind(this),this.error=this.error.bind(this)}initDd(){Wn.init({clientToken:"pub1b40d87cd5789b981aad8bd37e4e01a4",site:"us3.datadoghq.com",forwardErrorsToLogs:!1,sessionSampleRate:100,version:"0.5.4",service:"canvas-quiz-loader",env:"production",beforeSend:e=>{for(const t of this.debugConfig.excludeErrorPattern)if(e.message.includes(t))return!1;return!0}})}whenInitialized(){return this.initializationPromise}getQuizEnv(){let e,t;const n=setTimeout((()=>t),2e3),o=document.createElement("script");return o.src=browser.runtime.getURL("quiz-loader/injectable/get-env.js"),document.documentElement.appendChild(o),o.remove(),window.addEventListener("quizEnv",(t=>{e(t.detail),clearTimeout(n)})),new Promise(((n,o)=>{e=n,t=o}))}static getInstance(){if(!Yn.instance){const e=new Yn;let t;Yn.instance=e,this.instance.initializationPromise=new Promise((e=>t=e)),Vn.getDebugConfig().then((t=>e.debugConfig=t)).catch(e.error).finally((()=>{e.initDd(),t()}))}return Yn.instance}getLogBungle(){return Qn(this,void 0,void 0,(function*(){const e=[];return e.push("--------------- HTML SECTION START ---------------\n"),e.push(document.documentElement.outerHTML),e.push("\n--------------- HTML SECTION END ---------------\n\n"),e.push("--------------- CANVAS ENV SECTION START ---------------\n"),e.push(JSON.stringify(yield this.getQuizEnv(),null,2)),e.push("\n--------------- CANVAS ENV SECTION END ---------------\n\n"),e.push("--------------- LOGS SECTION START ---------------\n"),e.push(JSON.stringify(this.getLogs(),null,2)),e.push("\n--------------- LOGS SECTION END ---------------\n\n"),e.join("")}))}registerErrorListeners(){window.addEventListener("error",(e=>{const{message:t,filename:n,lineno:o,colno:r,error:s}=e;this.error("Unhandled Error:",{message:t,source:n,lineno:o,colno:r,error:s})})),window.addEventListener("unhandledrejection",(e=>{const t=e.reason;this.error("Unhandled Promise Rejection:",t)}))}startLogCapture(){this.registerErrorListeners(),browser.runtime.onMessage.addListener(((e,t,n)=>Qn(this,void 0,void 0,(function*(){switch(e.type){case Kn.DEBUG:return yield this.getLogBungle();case Kn.PING:return Kn.PONG;default:return Promise.reject(new Error("Invalid type"))}}))))}log(...e){this._storeLog("log",...e),console.log(...e)}info(...e){this._storeLog("info",...e),console.info(...e)}warn(...e){this._storeLog("warn",...e),console.warn(...e)}error(...e){const n=e.find((e=>e instanceof Error));this._storeLog("error",...e.map(t));const o=e.join(" ");if(-1!==this.debugConfig.saveBundleErrorPattern.findIndex((e=>o.includes(e)))){let e;Vn.postDebugBundle(this.getLogBungle()).then((t=>e=t)).catch((e=>{console.error(e),this._storeLog("error",t(e)),Wn.logger.error(e.message,null,e)})).finally((()=>Wn.logger.error(`${o} bundleId: ${e}`,null,n)))}else Wn.logger.error(o,null,n);console.error(...e)}_storeLog(e,...t){const n=(new Date).toISOString();this.logs.push({timestamp:n,type:e,message:t})}clearLogs(){this.logs=[]}getLogs(){return this.logs}}const Xn=Yn.getInstance();var Zn,eo;!function(e){e.TRUE="true",e.FALSE="false",e.PARTIAL="partial"}(Zn||(Zn={})),function(e){e[e.MULTIPLE_CHOICE=0]="MULTIPLE_CHOICE",e[e.TRUE_FALSE=1]="TRUE_FALSE",e[e.FILL_IN_BLANK=2]="FILL_IN_BLANK",e[e.FILL_IN_MULRIPLE_BLANKS=3]="FILL_IN_MULRIPLE_BLANKS",e[e.MULTIPLE_ANSWER=4]="MULTIPLE_ANSWER",e[e.MULTIPLE_DROPDOWN=5]="MULTIPLE_DROPDOWN",e[e.MATCHING=6]="MATCHING",e[e.NUMERICAL_ANSWER=7]="NUMERICAL_ANSWER",e[e.FORMULA_QUESTION=8]="FORMULA_QUESTION",e[e.ESSAY_QUESTION=9]="ESSAY_QUESTION"}(eo||(eo={}));const to="multiple_choice_question",no="true_false_question",oo="short_answer_question",ro="fill_in_multiple_blanks_question",so="multiple_answers_question",io="multiple_dropdowns_question",ao="matching_question",co="numerical_question",uo="calculated_question",lo="essay_question";const fo=Yn.getInstance();function po(e){return t=this,n=void 0,r=function*(){const t=document.getElementsByClassName("question_type"),n=new go,o=function(){const e=document.getElementsByClassName("question_points_holder");let t=[];for(let n of e){const e=n.parentElement.classList;for(let o=0;o<e.length;o++)"header"!=e[o]||t.push(n)}return t}(),r=function(){const e=[],t=document.getElementsByClassName("original_question_text");for(let n of t)e.push(parseInt(n.nextElementSibling.id.split("_")[1]));return e}();for(let s=0;s<r.length;s++){const i=t[s].innerText,a=r[s];if(e[a]){const t=e[a];try{switch(i){case lo:n.displayEssay(t,a);break;case ao:n.displayMatching(t,a);break;case io:n.displayMultipleDropdowns(t,a);break;case so:n.displayMultipleAnswer(t,a);break;case to:case no:n.displayMultipleChoise(t,a);break;case oo:case uo:case co:n.displayFillInBlank(t,a);break;case ro:n.displayFillInMultipleBlank(t,a)}}catch(e){fo.error(`Failed to display question ${a} of type ${i} because of the error`,e)}const r=Math.round(100*t.bestAnswer.points)/100;r==parseFloat(o[s].innerText)?o[s].classList.add("correct-answer"):o[s].classList.add("incorrect-answer"),o[s].innerText=`${r} out of ${o[s].innerText}`}else o[s].innerText=`(New Question) ${o[s].innerText}`}},new((o=void 0)||(o=Promise))((function(e,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(i,a)}c((r=r.apply(t,n||[])).next())}));var t,n,o,r}class go{displayMatching(e,t){if(!e)return;const n=document.querySelectorAll(`#question_${t} select`);for(const e of n)if(e.value)return;const o=e.bestAnswer;for(let e in o.dynamicFields)if(e.includes("answer_")){const n=`question_${t}_${e}`,r=document.getElementById(n);r.value=o.dynamicFields[e],r.dispatchEvent(new Event("change",{bubbles:!0}))}}displayMultipleDropdowns(e,t){if(!e)return;const n=document.getElementById(`question_${t}`),o=document.querySelectorAll(`#question_${t} select`);for(const e of o)if(e.value)return;const r=e.bestAnswer;for(let e in r.dynamicFields)if(e.includes("answer_id_for")){const t=r.dynamicFields[e];if(!t)continue;const o=n.querySelector(`option[value='${t}']`).parentElement;o.value=t,o.dispatchEvent(new Event("change",{bubbles:!0}))}}displayMultipleAnswer(e,t){if(!e)return;const n=document.querySelectorAll(`#question_${t} input[type="checkbox"]`);for(const e of n)if(e.checked)return;const o=e.bestAnswer;for(let e in o.dynamicFields)if(e.includes("answer_")){const n=`question_${t}_${e}`,r=document.getElementById(n);r.checked=1===parseInt(o.dynamicFields[e]),r.dispatchEvent(new Event("change",{bubbles:!0}))}}displayMultipleChoise(e,t){if(!e)return;const n=new Set;for(const t of e.attempts){const e=parseInt(t.text);t.correct===Zn.TRUE||isNaN(e)||n.add(e)}for(let e of n){const n=`question_${t}_answer_${e}`,o=document.getElementById(n);o&&o.parentElement.nextElementSibling.classList.add("incorrect-answer")}const o=document.querySelectorAll(`#question_${t} input`);for(let e of o)if(e.checked)return;if(!("answer_id"in e.bestAnswer.dynamicFields))return;const r=`question_${t}_answer_${e.bestAnswer.text}`,s=document.getElementById(r);s&&(function(e){return e.parentElement.nextElementSibling.className.includes("incorrect-answer")}(s)||(s.checked=!0,s.dispatchEvent(new Event("change",{bubbles:!0}))))}displayFillInBlank(e,t){if(!e)return;const n=e.bestAnswer;let o=null;const r=document.getElementsByName(`question_${t}`);for(let e of r)if("INPUT"===e.tagName){o=e;break}o.value||(o.value=n.text,o.dispatchEvent(new Event("change",{bubbles:!0})))}displayEssay(e,t,n=15,o=500){if(!e)return;const r=e.latestAnswer;let s;setTimeout((()=>{try{s=document.getElementById(`question_${t}_question_text`);const e=s.nextElementSibling.querySelector("#question_input_0_ifr"),n=e.contentDocument?e.contentDocument:e.contentWindow.document;setTimeout((()=>{const e=n.getElementById("tinymce");'<p><br data-mce-bogus="1"></p>'==e.innerHTML&&(e.innerHTML=r.text,e.dispatchEvent(new Event("input",{bubbles:!0})))}),0)}catch(o){n>0?this.displayEssay(e,t,n-1):s.innerHTML+=`<b><div>Previous answer</div></b><p>${r.text}</p>`}}),o)}displayFillInMultipleBlank(e,t){if(!e)return;const n=structuredClone(e.bestAnswer.dynamicFields);for(const t of e.attempts)for(const e in t.dynamicFields)if(e.startsWith("answer_id_for_")&&null!=t.dynamicFields[e]){const o=`answer_for${e.replace("answer_id_for","")}`;n[e]=t.dynamicFields[e],n[o]=t.dynamicFields[o]}const o=document.getElementById(`question_${t}_question_text`).parentElement,r=Object.keys(n).filter((e=>e.includes("answer_for"))).map((e=>{const t=`answer_id_for${e.replace("answer_for","")}`;return`<li class="${null!=n[t]?"checkmark":"cross"}">${e.replace(/_/g," ")}: ${n[e]}</li>`})),s=Object.keys(e.latestAnswer.dynamicFields).filter((e=>e.includes("answer_for"))).map((t=>{const n=`answer_id_for${t.replace("answer_for","")}`;return`<li class="${null!=e.latestAnswer.dynamicFields[n]?"checkmark":"cross"}">${t.replace(/_/g," ")}: ${e.latestAnswer.dynamicFields[t]}</li>`})),i=`\n      <div class="fill-in-multiple-blank-extra-info">\n        <div class="answers-panel" >\n          <div class="best-answer">\n            <h4>Best Answer</h4>\n            <ul class="answer-list">\n              ${r.join("")}\n            </ul>\n          </div>\n          <br>\n          <div class="latest-answer">\n            <h4>Latest Answer</h4>\n            <ul class="answer-list">\n              ${s.join("")}\n            </ul>\n          </div>\n        </div>\n      </div>\n    `,a=(new DOMParser).parseFromString(i,"text/html");o.prepend(a.body.firstElementChild)}}const mo=Yn.getInstance(),ho=Yn.getInstance();ho.startLogCapture(),ho.whenInitialized().then((function(){return t=this,n=void 0,r=function*(){window.location.href.toLocaleLowerCase().includes("://byui.")&&(yield new Promise((e=>setTimeout(e,2e3))));const t=window.location.href,n=parseInt(t.split("courses/")[1].split("/")[0]),o=parseInt(t.split("quizzes/")[1].split("/")[0]),r=t.split("/"),s=`${r[0]}//${r[2]}/`;n?o||mo.error("Unable to retrieve quiz id"):mo.error("Unable to retrieve course id");const i=yield function(e,t,n){return o=this,r=void 0,i=function*(){const o=`${n}api/v1/courses/${e}/quizzes/${t}/`,r=o+"submissions",[s,i]=yield Promise.all([fetch(o),fetch(r)]),[a,c]=yield Promise.all([s.text(),i.text()]),[u,l]=[JSON.parse(a),JSON.parse(c).quiz_submissions];if(!(null==l?void 0:l.length))return[];const d=u.assignment_id,f=l.at(-1).user_id;if(!d)return Xn.info("No assignment id found. This is a practice quiz"),[];if(!f)throw new Error("Unable to retrieve userId");return fetch(`${n}api/v1/courses/${e}/assignments/${d}/submissions/${f}?include[]=submission_history`).then((e=>e.text())).then((e=>JSON.parse(e).submission_history))},new((s=void 0)||(s=Promise))((function(e,t){function n(e){try{c(i.next(e))}catch(e){t(e)}}function a(e){try{c(i.throw(e))}catch(e){t(e)}}function c(t){var o;t.done?e(t.value):(o=t.value,o instanceof s?o:new s((function(e){e(o)}))).then(n,a)}c((i=i.apply(o,r||[])).next())}));var o,r,s,i}(n,o,s);if(!i.length)return;const a=function(t){if(!t[0].submission_data)return null;const n={};for(let o=0;o<t.length;o++){const r=t[o];for(let t of r.submission_data){const o=t.question_id;let r;1==t.correct?r=Zn.TRUE:0==t.correct?r=Zn.FALSE:"partial"==t.correct&&(r=Zn.PARTIAL);const s={correct:r,text:t.text,points:t.points,dynamicFields:e(t,((e,t)=>t.startsWith("answer")))};o in n||(n[o]={attempts:[],bestAnswer:s,latestAnswer:s});const i=n[o];i.attempts.push(s),(1==t.correct||i.bestAnswer.points<t.points)&&(i.bestAnswer=s)}}return n}(i);if(mo.info("correctAnswers:",a),mo.info("submissions:",i),!a)return null;yield po(a)},new((o=void 0)||(o=Promise))((function(e,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(i,a)}c((r=r.apply(t,n||[])).next())}));var t,n,o,r}))})();
//# sourceMappingURL=index.js.map